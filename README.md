# Система сбора информации

### Описание

Система состоит из 2-х компонентов: сервер на базе Flask, клиент-демон для linux.
Клиент каждые 10 секунд отправляет через REST на сервер текущую утилизацию CPU в %. Сервер их сохраняет и отображает пользователю в браузере.  

#### Cтраница для пользователя содержит:
- таблицу со 100 последними записями и возможностью сортировки (JS)
- отдельно агрегированные данные:
    - min/max/avg 100 последних записей
    - min/max/avg всех записей в БД
  
Данные динамически обновляются через AJAX раз в 10 секунд или по кнопке "Update"


### Технологии
- Python 3
- Flask
- SQLAlchemy
- SQLite
- Jinja2

### Запуск сервера
1. создайте виртуальное окружение
```bash
python3 -m venv venv
```
2. активируйте виртуальное окружение
```bash
source venv/bin/activate
```
3. разверните сервер 
```bash
pip3 install git+https://github.com/sergei-tolshin/CPU-load.git#egg=cpuload
```
4. запустите сервер
```bash
cpuload --host 0.0.0.0 --port 8001
```

### Запуск клиента-демона
1. Загрузите файл
```bash
wget https://raw.githubusercontent.com/sergei-tolshin/CPU-load/main/bash/cpu_load.sh
```
2. Измените права на файл
```bash
chmod a+x cpu_load.sh
```
3. Запустите клиента-демона, заменив `0.0.0.0` на ip адрес вашего сервера
```bash
setsid cpu_load.sh -h 0.0.0.0 -p 8001 > /dev/null 2>&1 < /dev/null &
```


### Просмотр полученной от клиента информации
Перейдите в браузере по адресу <http://0.0.0.0:8001/clients/> и кликните по имени клиента

### Документация и доступные эндпоинты
API документация находится по адресу <http://0.0.0.0:8001/apidocs>
